/*! dst-web - v0.0.1 - 2014-04-18 */
"use strict";angular.module("dstWebApp",["ngRoute","ngResource","ngSanitize","dstWebApp.controllers","dstWebApp.directives","pascalprecht.translate"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/windows.html",controller:"WinDesktopCtrl"}).otherwise({redirectTo:"/"})}]).config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:"languages/",suffix:".json"}),a.preferredLanguage("en_US")}]);var directiveModule=angular.module("dstWebApp.directives",[]),controllerModule=angular.module("dstWebApp.controllers",[]);$.fn.extend({split:function(a){return this.each(function(){var b=$(this),c=$('<div class="split"></div>'),d=$('<div class="arrow"></div>'),e=(b.next(),b.parent()),f={isClose:!1,direction:"horizontal",isFolding:!1},g=a.isClose||f.isClose,h=a.direction||f.direction,i=a.isFolding||f.isFolding;f.max=3*("horizontal"===h?e.width():e.height())/4,f.min=("horizontal"===h?e.width():e.height())/4;var j=(a.max||f.max,a.min||f.min);$(this).append(c),i&&($(this).children(".split").append(d),g&&("horizontal"===h?b.width(c.width()).next().width(e.width()-b.width()):b.height(c.height()).next().height(e.height()-b.height()),c.css("cursor","pointer")),c.on("click",function(){return g?("horizontal"===h?b.width(j).next().width(e.width()-j):b.height(j).next().height(e.height()-j),g=!1,"horizontal"===h?c.css("cursor","e-resize"):c.css("cursor","s-resize"),!1):void 0}),d.on("click",function(){return console.log("33333333333"),g===!1?(c.css("cursor","pointer"),"horizontal"===h?b.width(c.width()).next().width(e.width()-b.width()):b.height(c.height()).next().height(e.height()-b.height()),g=!0):("horizontal"===h?c.css("cursor","e-resize"):c.css("cursor","s-resize"),"horizontal"===h?b.width(j).next().width(e.width()-j):b.height(j).next().height(e.height()-j),g=!1),!1})),b.children(".split").mousedown(function(a){var b="horizontal"===h?a.screenX:a.screenY,c="horizontal"===h?$(this).parent().width():$(this).parent().height(),d=$(this).parent();return $(document).mousemove(function(a){var f=0,g=0;"horizontal"===h?(f=a.screenX-b,g=(f+c)/e.width()*100,g>=90&&(g=90),10>=g&&(g=10),d.css("width",g+"%").next().css("width",100-g+"%")):(f=a.screenY-b,g=(f+c)/e.height()*100,g>=90&&(g=90),10>=g&&(g=10),d.css("height",g+"%").next().css("height",100-g+"%"))}),$(document).mouseup(function(){$(document).off("mousemove"),$(document).off("mouseup")}),!1})})}}),directiveModule.directive("dsButtons",["$rootScope",function(){return{restrict:"EA",replace:!0,transclude:!0,template:"<div ng-transclude></div>",link:function(){}}}]).directive("dsButtonItem",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{id:"@",name:"@",tooltip:"@",isActive:"@"},template:function(a,b){return"true"===b.isActive?'<button title="{{tooltip}}" class="dss-btn-act">{{name}}</button>':'<button title="{{tooltip}}" class="dss-btn-nor">{{name}}</button>'},link:function(a,b){b.bind("click",function(){a.$emit("buttonClick",a)})}}}),directiveModule.directive("dsDesktopIcons",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{draggable:"@"},template:function(a,b){var c='<div id="dss-desk-icon"><ul class="dss-list-mid-icon">';return c+="true"===b.draggable?'    <li ng-repeat="item in items" ng-dblclick="iconClick(item.id)" ds-draggable><i class="{{item.icon}}"></i>':'    <li ng-repeat="item in items" ng-dblclick="iconClick(item.id)"><i class="{{item.icon}}"></i>',c+='        <p class="dss-list-txt-top"><span class="dss-file-name">{{item.name}}</span><span class="dss-file-type"><span class="dss-file-type-txt">类型：</span>{{item.type}}</span></p>         <p class="dss-list-txt-bottom"><span class="dss-file-time"><span class="dss-file-time-txt">修改日期: </span>2014/2/13 17:22</span><span class="dss-file-size"><span class="dss-file-size-txt">大小：</span>121.k</span></p>    </li></ul><div ng-transclude></div></div>'},controller:["$scope","$element","$attrs","$transclude",function(a){a.items=[],this.addItem=function(b){a.items.push(b)}}],link:function(a){a.iconClick=function(b){a.id=b,a.$emit("iconClick",a)}}}}).directive("dsDesktopIconItem",function(){return{restrict:"EA",replace:!0,transclude:!0,require:"?^dsDesktopIcons",scope:{id:"@",icon:"@",name:"@",type:"@"},link:function(a,b,c,d){d.addItem(a)}}}),directiveModule.directive("dsDialog",["$rootScope",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{id:"@",name:"@",width:"@",height:"@",icon:"@",visible:"@",btncancel:"@",btnok:"@"},template:function(){var a='<div class="dss-winBox"> <div class="dss-win-outer">    <div class="dss-win-inner">        <div class="dss-title-bar">            <div class="dss-win-title-icon"></div>            <div class="dss-window-title dss-title-text">{{name}}</div>            <div class="dss-window-btn-bar">                <a class="dss-closewin-btn" title="{{\'windows.close\'|translate}}"></a>            </div>        </div>        <div class="dss-window-content">            <i ng-show="icon!==undefined" class="{{icon}} dss-float-l dss-margin-r10"></i>            <span ng-transclude></span>        </div>          <div class="dss-btn-group">            <button class="dss-btn-nor" ng-click="btnCancel()" ng-show="btncancel!==undefined">{{\'btn.cancel\'|translate}}</button>             <button class="dss-btn-act" ng-click="btnOk()" ng-show="btnok!==undefined">{{\'btn.ok\'|translate}}</button>           </div>    </div> </div></div>';return a},compile:function(){return{post:function(a,b){function c(){var b=a.width?a.width>=$(document.body).width()?$(document.body).width()-i:a.width:500,c=a.height?a.height>=$(document.body).height()?$(document.body).height()-i:a.height:400,f=($(document.body).width()-b-i)/2,g=($(document.body).height()-c-i-40)/2;$(j).parents(".dss-winBox").css({width:b,height:c,left:f,top:g}),$(j).parents(".dss-winBox").find(".dss-closewin-btn").bind("click",d),e($(j).parents(".dss-winBox")),"false"===a.visible&&$(j).parents(".dss-winBox").hide()}function d(){a.Hide()}function e(a){var b=a.find(".dss-win-inner"),c=b.find(".dss-window-content").position().top,d=b.find(".dss-window-btm").height(),e=b.find(".dss-sub-menu-fix").height();$(".dss-menu-rt-unfold")?a.find(".dss-window-content").css("height",a.height()-c-d):"true"===a.find(".dss-menu-rt-unfold").attr("unfoldOnOff")?a.find(".dss-window-content").css("height",b.height()-c-d):a.find(".dss-window-content").css("height",b.height()-c-d-e)}function f(){$(document).mouseup(function(){$(document).off("mousemove"),$(document).off("mouseup")})}function g(){for(var a=$(".dss-winBox"),b=parseInt(a.eq(0).css("z-index")),c=1;c<a.length;c++)a.eq(c).css("z-index")>parseInt(b)&&(b=a.eq(c).css("z-index"));var d=parseInt(b)+1;$(j).parents(".dss-winBox").css("z-index",d).removeClass("dss-noCurWin").siblings(".dss-winBox").addClass("dss-noCurWin")}function h(a){var b=0,c=0;a.mousedown(function(a){var d=$(this).parents(".dss-winBox").offset();b=a.pageX-d.left,c=a.pageY-d.top;var e=$(this);return g(),$(document).mousemove(function(a){var d=a.pageX-b,f=a.pageY-c,g=$(document).height()-e.parents(".dss-winBox").find(".dss-title-bar").outerHeight()-$("#dss-wrap-bottom-bar").height()-5;return 0>f?f=0:f>g&&(f=g),e.parents(".dss-winBox").offset({left:d,top:f}),!1}),f(),!1}),a.parents(".dss-winBox").click(function(){g()})}a.Show=function(){a.$emit("window-show",a),$(b).parents(".dss-winBox").fadeIn()},a.Close=function(){a.Hide()},a.Hide=function(){var a=$(b);a.fadeOut()},a.ShowModel=function(){},a.ShowPage=function(){},a.btnCancel=function(){a.id=a.btncancel,a.$emit("buttonClick",a),a.Hide()},a.btnOk=function(){a.id=a.btnok,a.$emit("buttonClick",a)};var i=10,j=angular.element(b.children()[0]);c(),h($(b).find(".dss-title-bar")),$(document).click(function(){$(".dss-top-wrap-site").removeClass("dss-top-wrap-site-act"),$(".dss-sub-cont-file").hide(),$(".dss-top-tool2-sub").find("ul").hide(),$(".dss-top-cont-menu").children("li").children("ul").hide(),$("#dss-thumb-icon").children("li").children("div").hide(),$(".dss-top-menu-cont>li").children("ul").hide(),$(".dss-top-menu-cont").attr("onOff",!1).children("li").attr("onOff",!0).removeClass("hover"),$(".dss-tool-bar").find(".dss-sub-tool").hide().end().find(".dss-ico-tool-custome").attr("onOff",!0)}),$(document).on({contextmenu:function(a){a.preventDefault()}})}}}}}]),directiveModule.directive("dsDesktop",function(){return{restrict:"EA",replace:!0,transclude:"element",template:'<div style=" height: 100%"></div>',compile:function(a,b,c){return function(a,b){c(a,function(a){b.append(a)})}}}}).directive("dsPages",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{id:"@",visible:"@"},template:'<div style=" height: 100%" ng-transclude></div>',controller:["$scope","$element","$attrs","$transclude",function(a){a.items=[],this.addItem=function(b){a.items.push(b)},this.showPage=function(a){$("#"+a).fadeIn(100).siblings().fadeOut()},this.showPageByName=function(b){var c="";a.items.forEach(function(a){a.name===b&&(c=a.id)}),console.log(c,b),$("#"+c).fadeIn(100).siblings().fadeOut()},a.showOrHide=function(a){console.log(a.id,a.visible),"true"===a.visible?$("#"+a.id).fadeIn(100):$("#"+a.id).hide()},this.showVisiblePage=function(){console.log("showVisiblePage run"),a.items.forEach(function(b){a.showOrHide(b)})}}],link:function(a,b,c,d){"false"===c.visible&&$(b).hide(),d.showVisiblePage(),a.$on("switchPageById",function(a,b){console.log("switchPageById:"+b),d.showPage(b)}),a.$on("switchPageByName",function(a,b){d.showPageByName(b)})}}}).directive("dsPage",function(){return{restrict:"EA",replace:!0,transclude:!0,require:"?^dsPages",scope:{id:"@",name:"@",visible:"@"},template:"<div ng-transclude></div>",link:function(a,b,c,d){d.addItem(a),"false"===c.visible?$(b).fadeOut():$(b).fadeIn()}}}).directive("dsPanel",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{name:"@"},template:'<div class="dss-window-content" name="{{name}}" style="height:100%" ng-transclude></div>',link:function(){}}}).directive("dsDatetime",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{strCurrentTime:"@"},template:'<a><em ng-bind-html="strCurrentTime"></em></a>',link:function(a){a.strCurrentTime="loading...";setInterval(function(){a.$apply(function(){var b=new Date,c=b.getFullYear(),d=b.getMonth()+1,e=b.getDate(),f=b.getHours(),g=b.getMinutes(),h=b.getSeconds()<10?"0"+b.getSeconds():b.getSeconds();10>f&&(f="0"+f),10>g&&(g="0"+g);var i=c+"/"+d+"/"+e,j=f+":"+g+":"+h;a.strCurrentTime=j+"<br/>"+i})},1e3)}}}).directive("dsSeparator",function(){return{restrict:"EA",replace:!0,template:'<li class="dss-menu-line"><span></span></li>'}}).directive("dsDraggable",["$document",function(a){return{restrict:"A",link:function(b,c){function d(a){i=a.pageY-g,h=a.pageX-f,c.css({top:i+"px",left:h+"px"})}function e(){a.unbind("mousemove",d),a.unbind("mouseup",e)}var f=0,g=0,h=0,i=0;c.css({position:"relative",cursor:"pointer"}),c.on("mousedown",function(b){b.preventDefault(),f=b.pageX-h,g=b.pageY-i,a.on("mousemove",d),a.on("mouseup",e)})}}}]),directiveModule.directive("dsList",["$rootScope",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{type:"@"},template:'<div class="dss-list-view" ng-transclude></div>',link:function(){}}}]).directive("dsListGroup",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{name:"@"},controller:["$scope","$element","$attrs","$transclude",function(a){a.items=[],this.addItem=function(b){a.items.push(b)}}],template:function(a){var b="li",c=$(a).parent().attr("type")||"TILE",d=$(a).parent().attr("c")||"";switch(c.toUpperCase()){case"SUPER":b="supBig";break;case"BIG":b="big";break;case"MID":b="mid";break;case"SAMLL":b="small";break;case"TILE":b="tile";break;case"CONTENT":b="content";break;default:b="li"}var e='<div><h2 class="dss-list-title" ng-show="name!==undefined">         <i class="dss-ico-fold-arrow-open"></i>        <span class="dss-list-t">{{name}}({{items.length}})</span>        <span class="dss-list-line"></span></h2>   <ul class="dss-list-'+b+"-icon "+d+'">   <li ng-repeat="item in items" ds-bind-popmenu={{item.dsBindPopmenu}} id="{{item.id}}"><i class="{{item.icon}}"></i>      <p class="dss-list-txt-top">       <span class="dss-file-name">{{item.name}}</span>       <span class="dss-disk-space" ng-show="item.diskspace!==undefined"><span style="width:{{item.diskspace}}"></span></span>       <span class="dss-file-type"><span class="dss-file-type-txt">{{"windows.type"|translate}}: </span>{{item.type}}</span>      </p>      <p class="dss-list-txt-bottom">       <span class="dss-file-time"><span class="dss-file-time-txt">{{"windows.dateModified"|translate}}: </span>{{item.modifytime}}</span>       <span class="dss-file-size"><span class="dss-file-size-txt">{{"windows.size"|translate}}: </span>{{item.filesize}}</span>      </p>     </li>   </ul><div ng-transclude></div></div>';return e},link:function(a,b){var c="",d=!0;$(b).find(".dss-list-title").children("i").hover(function(){c=$(this).attr("class"),$(this).removeClass().addClass(c+"-hover")},function(){$(this).removeClass().addClass(c)}).click(function(){d?($(this).removeClass().addClass("dss-ico-fold-arrow-close-hover").parent().next("ul").slideUp(200),c="dss-ico-fold-arrow-close",d=!1):($(this).removeClass().addClass("dss-ico-fold-arrow-open-hover").parent().next("ul").slideDown(200),c="dss-ico-fold-arrow-open",d=!0)})}}}).directive("dsListItem",function(){return{restrict:"EA",replace:!0,transclude:!0,require:"?^dsListGroup",scope:{id:"@",name:"@",tooltip:"@",icon:"@",type:"@",modifytime:"@",filesize:"@",diskspace:"@",dsBindPopmenu:"@"},link:function(a,b,c,d){a.icon=""!==a.icon?a.icon:"dss-icon-desktop",d.addItem(a)}}}),directiveModule.directive("dsMenubar",function(){return{restrict:"EA",replace:!0,transclude:!0,template:'<div class="dss-top-menu-bar">  <ul class="dss-top-menu-cont" ng-transclude>  </ul>  <span class="dss-line-h-solid dss-line-blue"></span></div>',link:function(){}}}).directive("dsMenuItem",["$compile",function(a){return{restrict:"EA",replace:!0,transclude:!0,scope:{id:"@",name:"@",width:"@",shortcut:"@",enabled:"@",submenu:"@",icon:"@"},template:function(a,b){var c=b.width||200;return"true"===b.submenu?"<li ng-class=\"enabled=='false'?'disabled':''\" onoff=\"true\">{{name}}<ul style=\"width:"+c+'px;display:none;" ng-transclude></ul></li>':'<li ng-class="enabled==\'false\'?\'disabled\':\'\'" onoff="false"><i class="{{icon}}"></i><span>{{name}}<em ng-show="shortcut!==\'\'">{{shortcut}}</em><i class="dss-ico-arrow-rt"></i></span><ul style="width:'+c+'px;display:none;" ng-transclude></ul></li>'},link:function(b,c,d){function e(){0!==$(c).parents("ul").children("li[onoff=false]").length&&($(c).siblings().attr("onOff",!0).removeClass("hover").find("ul").hide(),$(c).addClass("hover").attr("onOff",!1).children("ul").show())}function f(a){return b.$emit("window-settop",$(c).parents(".dss-winBox")),d.id&&(b.objEvent=a,b.$emit("menuClick",b)),"true"===$(c).attr("onOff")?($(".dss-top-menu-cont").find("ul").hide(),$(c).siblings().removeClass("hover").end().find("ul:eq(0)").show().end().addClass("hover").attr("onOff",!1).parent().attr("onOff",!0)):($(c).removeClass("hover").find("ul").hide(),$(c).parents(".dss-top-menu-cont").children("li").removeClass("hover").end().find("ul").hide(),$(".dss-top-menu-cont").children("li").andSelf().attr("onOff",!0)),!1}b.id=d.id||"",b.name=d.name||"",b.width=d.width||200,b.shortcut=d.shortcut||"",b.enabled=d.enabled||"true",b.submenu=d.submenu||"false",b.icon=d.icon||"";var g=0===c.find("li").length?"false":"true";if("false"===g&&"true"!==b.submenu){var h='<i class="{{icon}}"></i><span>{{name}}<em ng-show=\'shortcut!==""\'>{{shortcut}}</em></span>';c.html(h),a(c)(b)}c.bind("mouseover",e),c.bind("click",function(a){f(a),a.stopPropagation()})}}}]),directiveModule.directive("dsMenutab",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:"./template/dsMenutab.html",controller:["$scope","$element","$attrs","$transclude",function(a){a.tabs=[],this.addItem=function(b){a.tabs.push(b)},this.clearItem=function(){a.tabs=[]}}],link:function(a,b){function c(a){var b=a.find(".dss-win-inner"),c=b.find(".dss-window-content").position().top,d=b.find(".dss-window-btm").height(),e=b.find(".dss-sub-menu-fix").height();$(".dss-ico-unfold")?a.find(".dss-window-content").css("height",a.height()-c-d-10):"true"===a.find(".dss-ico-unfold").attr("foldOnOff")?a.find(".dss-window-content").css("height",b.height()-c-d-10):a.find(".dss-window-content").css("height",b.height()-c-d-e-10)}function d(a,b){a.css("width",b)}function e(a){a.is(":hidden")?a.show():a.hide()}d($(b).find(".dss-menu-tab-cont").children("ul"),"100%"),a.tabMenuClick=function(b,c){console.log("tabMenuClick:"+b);var d=$(".dss-menu-tab-title").children("li").eq(b),e=$(d).closest(".dss-wrap-menu-tab").children(".dss-menu-tab-cont").children("ul"),f=$(d).parents(".dss-wrap-top-menu-bar"),g=f.find(".dss-ico-unfold");return"true"==g.attr("foldonoff")?(console.log("1"),e.css({position:"absolute",top:"24px"})):(console.log("2"),e.css({position:"relative",top:"-1px"})),e.hide().eq(b).show(),d.siblings().removeClass("active").end().addClass("active").attr("show",!0).siblings().attr("show",!1),a.$emit("window-settop",$(d).parents(".dss-winBox")),c.stopPropagation(),!1},$(".dss-top-menu-lt").children("h2").click(function(){return e($(this).next()),a.$emit("window-settop",$(this).parents(".dss-winBox")),!1}),$(".dss-ico-unfold").attr("foldOnOff",!0).click(function(){var a=$(this).parents(".dss-wrap-top-menu-bar"),b=a.find(".dss-menu-tab-title").children("li"),d=a.find(".dss-menu-tab-cont").children("ul"),e=a.parents(".dss-winBox");if("true"===$(this).attr("foldOnOff")){var f=!1,g=-1;b.each(function(){"true"===$(this).attr("show")&&(f=!0,g=$(this).index())}),console.log(f),0==f&&(g=0),b.eq(g).addClass("active"),d.eq(g).show(),d.eq(g).css({position:"relative",top:"-1px"}),$(this).attr("foldOnOff",!1).removeClass("dss-ico-arrow-down").addClass("dss-ico-arrow-up"),c(e)}else $(this).removeClass("dss-ico-arrow-up").addClass("dss-ico-arrow-down").attr("foldOnOff",!0),d.hide().css({position:"absolute",top:"23px"}),b.removeClass("active").attr("show",!1),e.find(".dss-window-content").css("height",e.height()-160);return!1}),$(".dss-top-menu-cont").children("li").click(function(){return"true"===$(this).attr("onOff")?($(".dss-top-menu-cont>li").children("ul").hide(),$(this).siblings().removeClass("hover").end().children("ul").show().end().addClass("hover").attr("onOff",!1).parent().attr("onOff",!0)):($(this).removeClass("hover").children("ul").hide(),$(".dss-top-menu-cont").children("li").andSelf().attr("onOff",!0)),a.$emit("window-settop",$(this).parents(".dss-winBox")),$(".dss-tool-bar").find("ul").hide().prev("i").attr("onOff",!0),!1}).mouseover(function(){for(var a="",b=0;b<$(".dss-top-menu-cont>li").length;b++)a+=$($(".dss-top-menu-cont>li")[b]).attr("onOff");-1!==a.indexOf("false")&&"true"===$(this).parent().attr("onOff")&&($(".dss-top-menu-cont>li").children("ul").hide(),$(this).siblings().removeClass("hover").end().addClass("hover").attr("onOff",!1).children("ul").show())}).children("ul").hide().end().attr("onOff",!0),$(".dss-sub-file>li").mouseover(function(){var a=$(this).parent().next($(".dss-file-collec")).children("div");a.hide(),a.eq($(this).index()+1).show(),$(this).addClass("hover").siblings().removeClass("hover"),$(this).index()===a.length-1&&a.eq(0).show()}).mouseout(function(){$(this).addClass()})}}}).directive("dsTab",function(){return{restrict:"EA",replace:!0,transclude:!0,require:"?^dsMenutab",scope:{name:"@"},template:function(){var a='<ul class="clearfix" ng-transclude></ul>';return a},link:function(a,b,c,d){d.addItem(a)}}}).directive("dsTabGroup",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{name:"@"},template:function(){var a="<li><ul ng-transclude></ul><h2>{{name}}</h2></li>";return a},link:function(){}}}).directive("dsTabGroupItems",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{name:"@",icon:"@"},template:'<li class="dss-sub-list"><ul ng-transclude></ul></li>',link:function(){}}}).directive("dsTabGroupItem",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{name:"@",icon:"@"},template:'<li><i class="{{icon}}"></i>{{name}}</li>',link:function(){}}}),directiveModule.directive("dsWinMetro",["$rootScope",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{username:"@"},templateUrl:"./template/dsMetro.html",link:function(a){function b(){for(var a=["#2d89ef","#0098ab","#0a58c1","#009f00","#da532c","#93009c","#5636b0","#009cae","#2d8aef","#3e17b9"],b=$("#dss-page-cont").find(".dss-rec-b-cont"),c=1;c<b.length-8;c++)b[c].style.backgroundColor=a[c%10]}function c(){var a=$("body"),b=$(".dss-bar");$(".dss-bar-m").width(a.width()-66),b.width(Math.round(a.width()*a.width()/$("#dss-page-cont").width()))}function d(a){0>a?a=0:a>$(".dss-bar-m").outerWidth()-$(".dss-bar").outerWidth()&&(a=$(".dss-bar-m").outerWidth()-$(".dss-bar").outerWidth()),$(".dss-bar").css("left",a);var b=a/($(".dss-bar-m").outerWidth()-$(".dss-bar").outerWidth());$("#dss-page-cont").css("left",($("#dss-page-wrap").outerWidth()-$("#dss-page-cont").outerWidth())*b)}function e(){$(document).mouseup(function(){$(document).unbind("mousemove"),$(document).unbind("mouseup")})}c(),b(),$("#dss-return-win").click(function(){a.$emit("metroClick",a)}),window.onresize=function(){c()},$(".dss-bar-l").add($(".dss-bar-r")).add($(".dss-bar")).hover(function(){$(this).addClass("dss-bg-scorll-over").removeClass("dss-bg-over")},function(){$(this).removeClass("dss-bg-scorll-over").addClass("dss-bg-over")}),$(".dss-bar-l").mousedown(function(){var a=$(".dss-bar"),b=a.position().left,c=parseInt(a.outerWidth()/50);a.css("left",b-c+"px"),d(a.position().left)}),$(".dss-bar-r").mousedown(function(){var a=$(".dss-bar"),b=a.position().left,c=parseInt(a.outerWidth()/50);a.css("left",b+c+"px"),d(a.position().left)}),$(".dss-bar").mousedown(function(a){var b=a.clientX-$(this).position().left;$(document).mousemove(function(a){var c=a.clientX-b;d(c)}),e()})}}}]).directive("dsMetroGroup",function(){return{restrict:"EA",replace:!0,transclude:!0,template:'<li class="dss-page-li"><ul class="dss-page-li-cont" ng-transclude></ul></li>'}}).directive("dsMetroItem",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{id:"@",name:"@",icon:"@",small:"@"},template:function(a,b){return"true"===b.small?'<li id="{{id}}" class="dss-rec-sm"><div class="dss-opacity"></div><div class="dss-rec-b-cont"><i class="{{icon}}"></i><h4>{{name}}</h4></div></li>':'<li id="{{id}}"><div class="dss-opacity"></div><div class="dss-rec-b-cont"><i class="{{icon}}"></i><h4>{{name}}</h4></div></li>'},link:function(a,b,c){$(b).bind("click",function(){c.id&&a.$emit("metroClick",a)})}}}),directiveModule.directive("dsPopmenu",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{id:"@"},template:function(){return'<div class="dss-rt-menu-content"><ul ng-transclude></ul></div>'},link:function(a,b){a.setIcon=function(a){b.find("i").each(function(){var b=$(this).attr("class").split("-");b[1]="icon"+a,$(this).attr("class",b.join("-"))})}}}}).directive("dsBindPopmenu",["$document",function(){return{restrict:"EA",link:function(a,b,c){function d(b){a.$emit("window-settop",f),g=(new Date).getTime(),j=b.touches[0].clientX-parseInt($(this).parents(".dss-winBox").css("left"))-parseInt($(this).parent().prev().outerWidth(!0)),k=b.touches[0].clientY-parseInt($(this).parents(".dss-winBox").css("top"))-105}function e(){h=(new Date).getTime(),i=h-g,i>400&&($(".dss-rt-menu-content").hide(),$("#"+c.dsBindPopmenu).css({left:j+"px",top:k+"px"}).show())}var f=b.parents(".dss-winBox");b.bind("mouseup",function(b){if(a.$emit("window-settop",f),3===b.which){{var d=b.clientX-parseInt(f.css("left"))-6,e=b.clientY-parseInt(f.css("top"))-7;parseInt(f.css("z-index"))+1}$(".dss-rt-menu-content").hide(),$("#"+c.dsBindPopmenu).css({left:d+"px",top:e+"px"}).show()}b.stopPropagation()}),$(".dss-rt-menu-content").children("ul").find("li").click(function(){return $(this).is(":has(ul)")?($(this).children("ul").show(),!1):($(this).closest(".dss-rt-menu-content").hide(),!1)});var g=0,h=0,i=0,j=0,k=0;$(b).addEventListener("touchstart",d,!1),$(b).addEventListener("touchend",e,!1)}}}]),directiveModule.directive("dsQuestion",["$rootScope",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:"./template/dsQuestion.html",controller:["$scope","$element","$attrs","$transclude",function(a){a.items=[],a.currentItem="",this.addItem=function(b){a.items.push(b),"true"===b.current&&this.setCurrentItem(b)},this.setCurrentItem=function(b){a.currentItem=b},a.preQuestion=function(){a.currentItem=a.currentItem.order<=1?a.items[parseInt(a.items.length)-1]:a.items[parseInt(a.currentItem.order)-2]},a.nextQuestion=function(){a.currentItem=a.currentItem.order>=a.items.length?a.items[0]:a.items[a.currentItem.order]},a.switchQuestion=function(b){a.currentItem=a.items[b],$(".dss-q-all").hide().prev(".dss-q-cur").show()}}],link:function(a){function b(){$(document).mouseup(function(){$(document).off("mousemove"),$(document).off("mouseup")})}{var c=0,d=0,e=$(".dss-question").width();$(".dss-question").height()}a.switchLanguage=function(){a.$emit("switchLanguage",a)},$("#dss-page-question").children(".dss-q-btn-close").click(function(){$(this);$(this).siblings().eq(0).is(":visible")?($(this).children("i").css({transform:"rotate(270deg)","-moz-transform":"rotate(0deg)","-webkit-transform":"rotate(0deg)","-o-transform":"rotate(0deg)"}),$(this).siblings().eq(0).animate({width:0,height:0,opacity:0},400,function(){$(this).hide()})):($(this).children("i").css({transform:"rotate(270deg)","-moz-transform":"rotate(225deg)","-webkit-transform":"rotate(225deg)","-o-transform":"rotate(225deg)"}),$(this).siblings().eq(0).css("height","auto").animate({width:e,opacity:1},400,function(){$(this).show()}))}).end().find(".dss-q-title").mousedown(function(a){var e=$(this).parents("#dss-page-question"),f=e.offset();c=a.pageX-f.left,d=a.pageY-f.top;var g=$(this);$(document).mousemove(function(a){var b=a.pageX-c,e=a.pageY-d,f=$(document).height()-$(".dss-q-title").height()-5-$("#dss-wrap-bottom-bar").height();return 0>b?b=0:b>$(document).width()-g.parents(".dss-winBox").outerWidth()&&(b=$(document).width()-g.parents(".dss-winBox").outerWidth()),20>e?e=20:e>f&&(e=f),g.parents("#dss-page-question").offset({left:b,top:e}),!1}),b()})}}}]).directive("dsQuestionItem",function(){return{restrict:"EA",replace:!0,transclude:!0,require:"^dsQuestion",scope:{id:"@",name:"@",order:"@",current:"@",status:"@",qcontext:"@",starttime:"@",endtime:"@",submittime:"@",lastmodifytime:"@"},link:function(a,b,c,d){d.addItem(a)}}}),directiveModule.directive("dsSpliter",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{id:"@",direction:"@",isFolding:"@",isClose:"@"},template:function(a,b){return"vertical"===b.direction?"<div class='dss-window-content dss-split-h' ng-transclude></div>":"<div class='dss-window-content dss-split-v' ng-transclude></div>"},link:function(a,b,c){var d="true"===c.isFolding?!0:!1,e="true"===c.isClose?!0:!1,f="horizontal";b.hasClass("dss-split-v")?f="horizontal":b.hasClass("dss-split-h")&&(f="vertical"),$(b).children(".dss-window-content-lt").split({max:750,min:150,isClose:e,direction:f,isFolding:d})}}}).directive("dsSpliterPanel",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{id:"@"},template:function(){return"<div class='dss-window-content-lt' ng-transclude></div>"},link:function(a,b){var c=b.parent().children(".dss-window-content-lt").length>0?!0:!1;c&&$(b.parent().children(".dss-window-content-lt")[1]).removeClass("dss-window-content-lt").addClass("dss-window-content-rt")}}}),directiveModule.directive("dsStatusbar",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{id:"@",font:"@"},template:function(){return'<div class="dss-window-btm" ng-style="{{font}}"  ng-transclude></div>'},link:function(a){a.font&&""!==a.font||(a.font='{font-size:12px;line-height:12px;font-family:"Times New Roman",Georgia,Serif}')}}}),directiveModule.directive("dsTaskbar",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{},template:'<div id="dss-wrap-bottom-bar"><h2 id="dss-return-metro"><i class="dss-icon32-to-metro"></i></h2><ul id="dss-lt-default-icon"><li ng-repeat="item in items.lock"  ng-click="showWin(item,$index)" id="{{item.id}}"><a><em><i class="{{item.icon}}"></i></em></a></li></ul><ul id="dss-thumb-icon"><li ng-repeat="item in items.default" ng-click="showWin(item,$index)" ng-mouseleave="hideThumbnail(item,$index)" ng-mouseenter="showThumbnail(item,$index)" id="{{item.id}}" targetid="{{item.targetid}}"><a><em><i class="{{item.icon}}"></i></em></a><div style="display:none"><div><h2><em><i ng-class="modifyIcon(item.icon)"></i></em>{{item.name}}<strong><i class="dss-icon16-close_thumb"></i></strong></h2><div id="thumb_{{item.type}}_{{$index}}"></div></div></div></li></ul><ul id="dss-rt-default"><li ng-repeat="item in items.tray"><a><em><i class="{{item.icon}}"></i></em></a></li><li><ds-datetime></ds-datetime></li></ul><div ng-transclude></div></div>',controller:["$scope","$element","$attrs","$transclude",function(a){a.items=[],a.items.lock=[],a.items.default=[],a.items.tray=[],this.addItem=function(b){switch(b.type){case"lock":a.items.lock.push(b);break;case"tray":a.items.tray.push(b);break;default:a.items.default.push(b)}};var b;a.showThumbnail=function(c,d){var e=$("#thumb_"+c.type+"_"+d).parents("li");$(e).show=setTimeout(function(){html2canvas($(".dss-winBox[id="+c.targetid+"]"),{onrendered:function(a){var b=112,f=200;f=a.width*b/a.height,f>200&&(f=200,b=a.height*f/a.width),$("#thumb_"+c.type+"_"+d).html(a),$(e).children("div").fadeIn().end().siblings().children("div").fadeOut().children("div").children("div").removeClass("hov")}})},300),$(e).children("div").bind("mouseenter",function(a){$(this).show().children("div").addClass("hov").find("strong").show().parents("li").siblings().find("strong").hide().parents("li").find("div").removeClass("hov"),clearTimeout(b),clearTimeout($(this)[0].timer),a.stopPropagation()}).bind("mouseleave",function(a){$(this).find("div").removeClass("hov").parents("li").find("strong").hide();var b=$(this);b[0].timer=setTimeout(function(){b.hide()},300),a.stopPropagation()}).bind("click",function(){for(var a=$(".dss-winBox"),b=parseInt(a.eq(0).css("z-index")),c=1;c<a.length;c++)a.eq(c).css("z-index")>parseInt(b)&&(b=a.eq(c).css("z-index"));var d=parseInt(b)+1;return $(this).hide(),$(this).parent().addClass("hover").siblings().removeClass("hover"),$(".dss-winBox").addClass("dss-noCurWin"),$(".dss-winBox[id='"+$(this).parent().attr("targetId")+"']").fadeIn().css("z-index",d).removeClass("dss-noCurWin"),!1}),$(e).find("strong").bind("click",function(){c.id&&a.$emit("closed",a);var b=$(".dss-winBox[id='"+$(this).parents("li").attr("targetId")+"']");return"dss-lt-default-icon"===$(this).parents("ul").attr("id")?(b.hide(),$(this).parents("li").removeClass().children("div").hide(),!1):($(this).parents("li").hide(),b.hide(),!1)})},a.hideThumbnail=function(a,c){var d=$("#thumb_"+a.type+"_"+c).parents("li");b=setTimeout(function(){$(d).children("div").hide()},400)},a.showWin=function(b){b.id&&(a.id=b.id,a.$emit("taskbarClick",a));for(var c=$(".dss-winBox[id='"+b.targetid+"']"),d=parseInt(c.css("z-index")),e=$(".dss-winBox"),f=parseInt(e.eq(0).css("z-index")),g=1;g<e.length;g++)e.eq(g).css("z-index")>parseInt(f)&&(f=e.eq(g).css("z-index"));var h=parseInt(f)+1;return c.is(":hidden")?($(".dss-winBox").addClass("dss-noCurWin"),c.show().css("z-index",h).removeClass("dss-noCurWin"),$("#dss-wrap-bottom-bar li[targetid='"+b.targetid+"']").addClass("hover").siblings().removeClass("hover")):c.is(":visible")&&(d===h-1?(c.hide(),$("#dss-wrap-bottom-bar li[targetid='"+b.targetid+"']").removeClass("hover")):h>d&&($(".dss-winBox").addClass("dss-noCurWin"),$("#dss-wrap-bottom-bar li[targetid='"+b.targetid+"']").addClass("hover").siblings().removeClass("hover"),c.css("z-index",h).show().removeClass("dss-noCurWin"))),!1},a.modifyIcon=function(a){return a=a.replace("32","16")
}}],link:function(a){$("#dss-return-metro").bind("mouseenter",function(){$(this).addClass("dss-re-metro-hover")}).bind("mouseleave",function(){$(this).removeClass()}).bind("click",function(){a.id="dss-return-metro",a.$emit("taskbarClick",a)})}}}).directive("dsTaskbarItem",function(){return{restrict:"EA",replace:!0,transclude:!0,require:"?^dsTaskbar",scope:{id:"@",type:"@",icon:"@",name:"@",status:"@",targetid:"@"},link:function(a,b,c,d){d.addItem(a)}}}),directiveModule.directive("dsToolbar",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{id:"@",font:"@","class":"@"},template:function(a,b){return b.class?'<div class="{{class}}" ng-style="{{font}}"><ul class="dss-tool-bar" ng-transclude></ul></div>':'<div class="dss-wrap-tool-bar" ng-style="{{font}}"><ul class="dss-tool-bar" ng-transclude></ul></div>'},link:function(a){a.font&&""!==a.font||(a.font='{font-size:12px;line-height:12px;font-family:"Times New Roman",Georgia,Serif}')}}}).directive("dsToolbarItem",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{id:"@",name:"@",tooltip:"@",enabled:"@",subtool:"@",icon:"@"},template:function(a,b){return"false"===b.enabled&&(b.icon=b.icon+"-disabled"),"true"===b.subtool?b.name?'<li title="{{tooltip}}"><i class="{{icon}}"><span></span></i><ul class="dss-sub-tool"><li class="dss-sub-tool-title">{{name}}</li><div ng-transclude></div></ul></li>':'<li title="{{tooltip}}"><i class="{{icon}}"><span></span></i><ul class="dss-sub-tool"><div ng-transclude></div></ul></li>':b.icon||b.name?'<li title="{{tooltip}}"><i class="{{icon}}"></i><span>{{name}}</span></li>':'<li title="{{tooltip}}" ng-transclude></li>'},link:function(a,b,c){a.tooltip||(a.tooltip=""),$(b).children("i").bind("click",function(){"false"!==c.enabled&&c.id&&a.$emit("toolbarClick",a)}),$(b).bind("click",function(){"false"!==c.enabled&&c.id&&a.$emit("toolbarClick",a)}),$(b).parents("dss-sub-tool")&&$(b).attr("choosed",!1).bind("click",function(){"false"===$(this).attr("choosed")?($(this).children("i").addClass("dss-ico-choose"),$(this).attr("choosed",!0)):($(this).children("i").removeClass("dss-ico-choose"),$(this).attr("choosed",!1))}),$(b).children("i").length&&$(b).hover(function(){var a=$(this).children("i").attr("class").split("-");return"disabled"===a[a.length-1]?!1:($(this).addClass("hover").siblings().removeClass("hover"),void 0)},function(){$(this).removeClass("hover")}).children("i").attr("onOff",!0).click(function(){return $(".dss-top-menu-cont").children("li").attr("onOff",!0).removeClass("hover").find("ul").hide(),$(this).parent().siblings().children("i").attr("onOff",!0).next("ul").hide(),"true"===$(this).attr("onOff")?($(this).next().show(),$(this).attr("onOff",!1)):($(this).next().hide(),$(this).attr("onOff",!0)),!1}).next("ul").children("li").click(function(){return $(this).parent("ul").hide(),$(this).parent("ul").prev("i").attr("onOff",!0),!1})}}}).directive("dsPathnavigation",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{width:"@"},template:function(a,b){var c=b.width||300;return'<div class="dss-site" style="width:'+c+'px"><i class="dss-icon16-computer"></i><i class="dss-ico-site-arrow"></i><span>{{"windows.computer"|translate}}</span><i class="dss-ico-site-arrow"></i><div class="dss-site-input"><input type="text"/></div><div><i class="dss-ico-arrow-down" title="上一个位置"></i></div><i class="dss-ico-site-refresh" title="刷新库"></i></div>'},link:function(){$(".dss-site").on("click",function(){var a=$(this).find("span").html();return $(this).find("input").val(a),$(this).find(".dss-site-input").show(),$(this).find("input").select(),$(this).addClass("dss-site-act"),!1})}}}).directive("dsSearch",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{placeholder:"@"},template:function(a,b){b.width||300;return'<div class="dss-search"><input type="text" placeholder="{{placeholder}}"/><i class="dss-ico-search"></i></div>'},link:function(){}}}),directiveModule.directive("dsTree",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{type:"@",swapAll:"@"},template:function(a,b){var c="WIN8";switch(b.type.toUpperCase()){case"WIN8":c="WIN8";break;case"MSDN":c="MSDN";break;default:c="WIN8"}var d='<div class="dss-wrap-tree">  <div class="dss-wrap-tree-menu">   <div id="'+c+'" class="'+c+'"><p class="MT_L0_HEADER"></p><ul class="MT_L0_BODY" ng-transclude>   </ul><p class="MT_L0_FOOTER"></p>  </div></div>';return d},link:function(){}}}).directive("dsTreeItem",["$compile",function(a){return{restrict:"EA",replace:!0,transclude:!0,require:"?^dsTree",scope:{id:"@",name:"@",tooltip:"@",icon:"@"},template:function(a,b){var c=""!==b.icon?b.icon:"dss-icon16-file",d="";return d='<li><p class="MT_L1_ITEM" ng-click="Swap()"><i class=\'dss-ico-fold-arrow-close\'></i><i class="'+c+"\"></i><a id='{{id}}' ng-click='Mark()'>{{name}}</a></p>",d+='<div style="display: none;" class="MT_L2">',d+='<p class="MT_L2_HEADER"></p>',d+='<ul class="MT_L2_BODY" ng-transclude></ul>',d+='<p class="MT_L2_FOOTER"></p>',d+="</div>",d+="</li>"},controller:function(){},link:function(b,c,d){var e=0===c.find("li").length?"false":"true",f=0===c.parents("li").length?"false":"true";if("false"===e){var g=""!==d.icon?d.icon:"dss-icon16-file",h='<li><p class="MT_L1_ITEM" ng-click="Swap()"><i class="'+g+"\"></i><a id='{{id}}' ng-click='Mark()'>{{name}}</a></p></li>";c.html(h),a(c)(b)}"false"===f&&(c.find("p")[0].className="MT_L0_ITEM"),"true"===c.parents(".dss-wrap-tree").attr("swapAll")&&c.find("div").each(function(a,b){b.style.display="block",c.find("i")[0].className="dss-ico-fold-arrow-open"}),b.Swap=function(){var a=c.find("div")[0];"none"===a.style.display?(a.style.display="block",c.find("i")[0].className="dss-ico-fold-arrow-open"):(a.style.display="none",c.find("i")[0].className="dss-ico-fold-arrow-close")},b.Mark=function(){c.parents(".dss-wrap-tree").find(".ACTIVE").each(function(a,b){b.className=b.className.split(" ")[0]}),c.parents(".dss-wrap-tree").find(".P_ACTIVE").each(function(a,b){b.className=b.className.split(" ")[0]}),c.find("a")[0].className=c.find("a")[0].className+" ACTIVE",c.find("p")[0].className=c.find("p")[0].className+" P_ACTIVE",d.id&&b.$emit("treeClick",b)}}}}]),directiveModule.directive("dsWindow",["$rootScope",function(){return{restrict:"EA",replace:!0,transclude:"element",scope:{id:"@",name:"@",width:"@",height:"@",position:"@",minimize:"@",maximize:"@",closeable:"@",icon:"@",visible:"@",resizeable:"@"},templateUrl:"./template/dsWindow.html",compile:function(a,b,c){return{pre:function(a,b){c(a,function(a){b.find(".ngtransclude").append(a)})},post:function(a,b,c){function d(){var d=a.width?a.width>=$(document.body).width()?$(document.body).width()-q:a.width:500,h=a.height?a.height>=$(document.body).height()?$(document.body).height()-q:a.height:400,i=null!=a.position&&""!==a.position?a.position:"center center";if(null===a.minimize||"undefined"==typeof a.minimize?$(r).parents(".dss-winBox").find(".dss-ico-minwin-btn").hide():"true"===a.minimize?$(r).parents(".dss-winBox").find(".dss-ico-minwin-btn").bind("click",e):$(r).parents(".dss-winBox").find(".dss-ico-minwin-btn").unbind("click").removeClass("dss-ico-minwin-btn").addClass("dss-ico-minwin-btn-disabled"),null===a.maximize||"undefined"==typeof a.maximize?$(r).parents(".dss-winBox").find(".dss-ico-maxwin-btn").hide():"true"===a.maximize?$(r).parents(".dss-winBox").find(".dss-ico-maxwin-btn").bind("click",f):$(r).parents(".dss-winBox").find(".dss-ico-maxwin-btn").unbind("click").removeClass("dss-ico-maxwin-btn").addClass("dss-ico-maxwin-btn-disabled"),null===a.closeable||"undefined"==typeof a.closeable?$(r).parents(".dss-winBox").find(".dss-ico-closewin-btn").hide():"true"===a.closeable?$(r).parents(".dss-winBox").find(".dss-ico-closewin-btn").bind("click",g):$(r).parents(".dss-winBox").find(".dss-ico-closewin-btn").unbind("click").removeClass("dss-ico-closewin-btn").addClass("dss-ico-closewin-btn-disabled"),$(r).parents(".dss-winBox").css("width",d),$(r).parents(".dss-winBox").css("height",h),""!==i){var l=i.split(" "),m=l[0],n=l[1],o=($(document.body).width()-d-q)/2,s=($(document.body).height()-h-q)/2;switch(m){case"left":$(r).parents(".dss-winBox").css("left","0");break;case"center":$(r).parents(".dss-winBox").css("left",o);break;case"right":$(r).parents(".dss-winBox").css("right","0");break;default:$(r).parents(".dss-winBox").css("left",parseInt(m))}switch(n){case"top":$(r).parents(".dss-winBox").css("top","0");break;case"center":$(r).parents(".dss-winBox").css("top",s);break;case"bottom":$(r).parents(".dss-winBox").css("bottom","0");break;default:$(r).parents(".dss-winBox").css("top",parseInt(n))}}"false"!==a.resizeable&&j(),k($(r).parents(".dss-winBox")),$(b).find(".dss-title-bar").get(0).addEventListener("touchstart",p,!1),"false"===a.visible&&($(r).parents(".dss-winBox").hide(),$("#dss-wrap-bottom-bar li[targetId='"+c.id+"']").hide())}function e(){return null!==a.id?a.$emit("window-minimized",a):a.hide(),!1}function f(){i();var b=$(document.body).width()-q,c=$(document.body).height()-q-41;$(r).parents(".dss-winBox").css("height",c),$(r).parents(".dss-winBox").css("width",b),$(r).parents(".dss-winBox").css("top","0"),$(r).parents(".dss-winBox").css("left","0"),$(r).parents(".dss-winBox").find(".dss-ico-maxwin-btn").unbind("click").bind("click",h).addClass("dss-normalwin-btn"),null!==a.id&&a.$emit("window-maximized",a),k($(r).parents(".dss-winBox")),m($(r).parents(".dss-winBox").find(".dss-menu-tab-cont").children("ul"),$(r).parents(".dss-winBox").find(".dss-wrap-top-menu-bar").width())}function g(){null!==a.id?a.$emit("window-closed",a):a.hide()}function h(){$(r).parents(".dss-winBox").css("height",s.height),$(r).parents(".dss-winBox").css("width",s.width),$(r).parents(".dss-winBox").css("top",s.top),$(r).parents(".dss-winBox").css("left",s.left),$(r).parents(".dss-winBox").find(".dss-ico-maxwin-btn").unbind("click").bind("click",f).removeClass("dss-normalwin-btn"),k($(r).parents(".dss-winBox")),m($(r).parents(".dss-winBox").find(".dss-menu-tab-cont").children("ul"),$(r).parents(".dss-winBox").find(".dss-wrap-top-menu-bar").width())}function i(){s.height=$(r).parents(".dss-winBox").css("height"),s.width=$(r).parents(".dss-winBox").css("width"),s.top=$(r).parents(".dss-winBox").css("top"),s.left=$(r).parents(".dss-winBox").css("left")}function j(){$(r).parents(".dss-winBox").find(".dss-title-bar").unbind("dblclick.re").bind("dblclick.max",function(){f(),$(r).parents(".dss-winBox").find(".dss-title-bar").unbind("dblclick.max").bind("dblclick.re",function(){h()})})}function k(a){console.log("setCrollHeight doing");var b=a.find(".dss-win-inner"),c=b.find(".dss-window-content").position().top,d=b.find(".dss-window-btm").height(),e=b.find(".dss-menu-tab-cont").height();$(".dss-ico-unfold")?a.find(".dss-window-content").css("height",a.height()-c-d-10):"true"===a.find(".dss-ico-unfold").attr("foldOnOff")?a.find(".dss-window-content").css("height",b.height()-c-d-10):a.find(".dss-window-content").css("height",b.height()-c-d-e-10)}function l(a){var b=350,c=320;a.B.on("mousedown",function(a){var b=$(this).parents(".dss-winBox"),d=a.pageY,e=b.height(),f=$(this);return $(document).on("mousemove",function(a){var b=a.pageY-d,g=f.parents(".dss-winBox");return g.css("height",b+e),g.outerHeight()<=c&&g.css("height",c),k(g),!1}),n(),$(document).trigger("mousedown"),!1}),a.R.on("mousedown",function(a){var c=$(this).parents(".dss-winBox"),d=a.pageX,e=c.width(),f=$(this);return $(document).on("mousemove",function(a){var c=a.pageX-d,g=f.parents(".dss-winBox"),h=g.width();return g.css("width",c+e),g.outerWidth()<=b&&g.css("width",b),a.pageX+20===$(document).width()&&(h=g.width()),m(g.find(".dss-menu-tab-cont").children("ul"),g.find(".dss-wrap-top-menu-bar").width()),!1}),n(),$(document).trigger("mousedown"),m(c.find(".dss-top-cont-menu").children("ul"),c.find(".dss-wrap-top-menu-bar").width()),!1}),a.Rb.on("mousedown",function(a){var d=$(this).parents(".dss-winBox"),e=a.pageX,f=a.pageY,g=d.width(),h=d.height(),i=$(this);return $(document).on("mousemove",function(a){var d=a.pageX-e,j=a.pageY-f,l=i.parents(".dss-winBox");return l.css({width:d+g,height:j+h}),l.outerHeight()<=c&&l.css("height",c),l.outerWidth()<=b&&(console.log(l.outerWidth()),l.css("width",b)),k(l),m(l.find(".dss-menu-tab-cont").children("ul"),l.find(".dss-wrap-top-menu-bar").width()),!1}),n(),$(document).trigger("mousedown"),m(d.find(".dss-top-cont-menu").children("ul"),d.find(".dss-wrap-top-menu-bar").width()),!1}),a.T.on("mousedown",function(a){var b=$(this).parents(".dss-winBox"),d=a.pageY,e=b.height(),f=b.offset().top,g=$(this);return $(document).on("mousemove",function(a){var b=d-a.pageY,h=g.parents(".dss-winBox");return h.css("height",b+e),h.offset({top:f-b}),h.outerHeight()<=c&&h.css("height",c).offset({top:f+(e-c)}),h.offset().top<=0&&h.offset({top:0}).css("height",e+f),k(h),!1}),n(),$(document).trigger("mousedown"),!1}),a.L.on("mousedown",function(a){var c=$(this).parents(".dss-winBox"),d=a.pageX,e=c.width(),f=c.offset().left,g=$(this);return $(document).on("mousemove",function(a){var c=d-a.pageX,h=g.parents(".dss-winBox");return h.css("width",c+e),h.offset({left:f-c}),h.outerWidth()<=b&&(h.css("width",b),h.offset({left:f+(e-b)})),m(h.find(".dss-menu-tab-cont").children("ul"),h.find(".dss-wrap-top-menu-bar").width()),!1}),n(),$(document).trigger("mousedown"),m(c.find(".dss-top-cont-menu").children("ul"),c.find(".dss-wrap-top-menu-bar").width()),!1}),a.Rt.on("mousedown",function(a){var d=$(this).parents(".dss-winBox"),e=a.pageX,f=a.pageY,g=d.width(),h=d.height(),i=d.offset().top,j=$(this);return $(document).on("mousemove",function(a){var d=a.pageX-e,l=f-a.pageY,n=j.parents(".dss-winBox");return n.css({width:d+g,height:l+h}),n.offset({top:i-l}),n.outerWidth()<=b&&n.css("width",b),n.outerHeight()<=c&&n.css("height",c).offset({top:i+(h-c)}),n.offset().top<=0&&n.offset({top:0}).css("height",h+i),k(n),m(n.find(".dss-menu-tab-cont").children("ul"),n.find(".dss-wrap-top-menu-bar").width()),!1}),n(),$(document).trigger("mousedown"),m(d.find(".dss-top-cont-menu").children("ul"),d.find(".dss-wrap-top-menu-bar").width()),!1}),a.Lt.on("mousedown",function(a){var d=$(this).parents(".dss-winBox"),e=a.pageX,f=a.pageY,g=d.width(),h=d.height(),i=d.offset().top,j=d.offset().left,l=$(this);return $(document).on("mousemove",function(a){var d=e-a.pageX,n=f-a.pageY,o=l.parents(".dss-winBox");return o.css({width:d+g,height:n+h}),o.offset({left:j-d,top:i-n}),o.outerWidth()<=b&&o.css("width",b).offset({left:j+(g-b)}),o.outerHeight()<=c&&o.css("height",c).offset({top:i+(h-c)}),o.offset().top<=0&&o.offset({top:0}).css("height",h+i),k(o),m(o.find(".dss-menu-tab-cont").children("ul"),o.find(".dss-wrap-top-menu-bar").width()),!1}),n(),$(document).trigger("mousedown"),m(d.find(".dss-menu-tab-cont").children("ul"),d.find(".dss-wrap-top-menu-bar").width()),!1}),a.Lb.on("mousedown",function(a){var d=$(this).parents(".dss-winBox"),e=a.pageX,f=a.pageY,g=d.width(),h=d.height(),i=d.offset().top,j=d.offset().left,l=$(this);return $(document).on("mousemove",function(a){var d=e-a.pageX,n=a.pageY-f,o=l.parents(".dss-winBox");return o.css({width:d+g,height:n+h}),o.offset({left:j-d}),o.outerWidth()<=b&&o.css("width",b).offset({left:j+(g-b)}),o.outerHeight()<=c&&o.css("height",c),o.offset().top<=0&&o.offset({top:0}).css("height",h+i),k(o),m(o.find(".dss-menu-tab-cont").children("ul"),o.find(".dss-wrap-top-menu-bar").width()),!1}),n(),$(document).trigger("mousedown"),m(d.find(".dss-menu-tab-cont").children("ul"),d.find(".dss-wrap-top-menu-bar").width()),!1})}function m(a,b){a.css("width",b)}function n(){$(document).mouseup(function(){$(document).off("mousemove"),$(document).off("mouseup")})}function o(b){var c=0,d=0;b.mousedown(function(e){var f=$(this).parents(".dss-winBox").offset();c=e.pageX-f.left,d=e.pageY-f.top;var g=$(this);return a.$emit("window-settop",b.parents(".dss-winBox")),$(document).mousemove(function(a){var b=a.pageX-c,e=a.pageY-d,f=$(document).height()-g.parents(".dss-winBox").find(".dss-title-bar").outerHeight()-$("#dss-wrap-bottom-bar").height()-5;return 0>e?e=0:e>f&&(e=f),g.parents(".dss-winBox").offset({left:b,top:e}),!1}),n(),!1}),b.parents(".dss-winBox").click(function(){a.$emit("window-settop",b.parents(".dss-winBox"))})}function p(b){function c(a){var b=a.touches[0].clientX-e,c=a.touches[0].clientY-f,d=$(document).height()-g.find(".dss-title-bar").outerHeight()-$("#dss-wrap-bottom-bar").height()-5;0>c&&(c=0),c>d&&(c=d),g.get(0).style.left=b+"px",g.get(0).style.top=c+"px",a.preventDefault()}function d(){document.removeEventListener("touchstart",p),document.removeEventListener("touchmove",c)}var e=b.touches[0].clientX-$(this).parents(".dss-winBox").get(0).offsetLeft,f=b.touches[0].clientY-$(this).parents(".dss-winBox").get(0).offsetTop,g=$(this).parents(".dss-winBox");document.addEventListener("touchmove",c,!1),a.$emit("window-settop",$(this).parents(".dss-winBox")),document.addEventListener("touchend",d,!1)}a.show=function(){a.$emit("window-show",a),$(b).fadeIn(),$("#dss-wrap-bottom-bar li[targetId='"+a.id+"']").fadeIn().addClass("hover"),k($(r).parents(".dss-winBox"))},a.close=function(){a.hide(),$("#dss-wrap-bottom-bar li[targetId='"+a.id+"']").hide()},a.hide=function(){var a=$(b);a.fadeOut(),$("#dss-wrap-bottom-bar li[targetId='"+a.attr("id")+"']").removeClass("hover");for(var c=$("#dss-thumb-icon li"),d=0;d<c.length;d++){var e=c.eq(d);if(e.attr("targetId")===a.attr("id")&&e.is(":hidden")){e.show();var f=e.remove();$("#dss-thumb-icon").append(f)}}},a.showModel=function(){},a.showPage=function(){},a.$on("showWinById",function(b,d){d===c.id&&a.show()});var q=10,r=angular.element(b.children()[0]),s={},t=$(".dss-win-inner"),u=t.find(".dss-window-resize-b"),v=t.find(".dss-window-resize-r"),w=t.find(".dss-window-resize-t"),x=t.find(".dss-window-resize-l"),y=t.find(".dss-window-resize-rb"),z=t.find(".dss-window-resize-rt"),A=t.find(".dss-window-resize-lt"),B=t.find(".dss-window-resize-lb"),C={B:u,R:v,Rb:y,T:w,L:x,Rt:z,Lt:A,Lb:B};d(),o($(b).find(".dss-title-bar")),"false"!==a.resizeable&&l(C),$(document).click(function(a){$(".dss-top-wrap-site").removeClass("dss-top-wrap-site-act"),$(".dss-sub-cont-file").hide(),$(".dss-top-tool2-sub").find("ul").hide(),$("#dss-thumb-icon").children("li").children("div").hide(),$(".dss-top-menu-cont>li").children("ul").hide(),$(".dss-top-menu-cont").attr("onOff",!1).children("li").attr("onOff",!0).removeClass("hover"),$(".dss-tool-bar").find(".dss-sub-tool").hide().end().find(".dss-ico-tool-custome").attr("onOff",!0),3!=a.which&&$(".dss-rt-menu-content").hide()}),$(document).on({contextmenu:function(a){a.preventDefault()}}),$("#dss-zoom-wallpaper-grid").on({click:function(){$(".dss-site-input").hide(),$(".dss-site").removeClass("dss-site-act"),$(".dss-sub-cont-file").hide(),$(".dss-wrap-tool2-sub").find("ul").hide(),$(".dss-ico-unfold").each(function(){var a=$(this).parents(".dss-wrap-top-menu-bar"),b=a.find(".dss-menu-tab-title").children("li"),c=a.find(".dss-menu-tab-cont").children("ul");"true"===$(this).attr("foldonoff")&&(b.removeClass("active").attr("show",!1),c.hide())}),$("#dss-thumb-icon").children("li").children("div").hide(),$(".dss-top-menu-cont>li").children("ul").hide(),$(".dss-tool-bar").find(".dss-sub-tool").hide().end().find(".dss-ico-tool-custome").attr("onOff",!0),$(".dss-top-menu-cont").attr("onOff",!1).children("li").attr("onOff",!0).removeClass("hover")},"mouseup.hideList":function(){},"mouseup.hideCon":function(){}})}}}}}]),controllerModule.controller("WinDesktopCtrl",["$translate","$scope",function(a,b){b.$broadcast("switchPageByName","default"),b.$on("switchLanguage",function(){"zh_CN"!=b.temp?(b.temp="zh_CN",a.use("zh_CN")):"zh_CN"===b.temp&&(b.temp="en_US",a.use("en_US"))})}]).controller("WinEventCtrl",["$rootScope","$scope","$translate",function(a,b){b.$on("metroClick",function(a,c){switch(c.id.trim()){case"dss-return-win":b.$broadcast("switchPageByName","default");break;default:console.log("catch event")}}),b.$on("taskbarClick",function(a,c){switch(c.id.trim()){case"dss-return-metro":b.$broadcast("switchPageByName","metro");break;default:console.log("catch event")}}),b.$on("toolbarClick",function(a,b){switch(b.id.trim()){case"dss-ico-tool-pro":alert("新建");break;default:console.log("catch event")}}),b.$on("menuClick",function(a,b){switch(console.log("WinEventCtrl menuClick on"),b.id.trim()){case"menbar-file-save":alert(a.name)}}),b.$on("buttonClick",function(){}),b.$on("treeClick",function(a,b){switch(b.id.trim()){case"tree-item-download":alert(a.name);break;default:console.log("treeClick!")}}),b.$on("iconClick",function(a,c){switch(c.id.trim()){case"ds-desktop-icon-item-computer":b.$broadcast("showWinById","dsswin-mycomputer"),b.$broadcast("window-settop",$("#dsswin-mycomputer"));break;default:console.log("iconClick!")}}),b.$on("window-show",function(a,b){switch(b.id){case"dsswin-mycomputer":console.log("窗口展示之前的要运行的逻辑可以放在这里处理");break;default:console.log("窗口展示之前的要运行的逻辑可以放在这里处理")}}),b.$on("window-minimized",function(a,b){switch(b.id){case"dsswin-file-01":b.hide();break;default:b.hide()}}),b.$on("window-maximized",function(a,b){switch(b.id.trim()){case"dsswin-file-01":console.log("捕抓窗口1的最大化按钮");break;default:console.log("默认最大化处理")}}),b.$on("window-closed",function(a,b){switch(b.id.trim()){case"dsswin-file-01":b.close();break;default:b.close()}})}]),controllerModule.controller("WindowCtrl",["$rootScope","$scope",function(a,b){b.$on("window-settop",function(a,c){b.setWindowTop(c)}),b.$on("menuClick",function(a,c){console.log("WindowCtrl menuClick on"),""!==c.id&&c.id.indexOf("changeListView")>=0&&b.changeListView(a,c),"formatPanD"===c.id&&($("#dsswin-format").show(),b.setWindowTop($("#dsswin-format"))),"formatPanC"===c.id&&($("#dssDialog-box-02").show(),b.setWindowTop($("#dssDialog-box-02")))}),b.$on("treeClick",function(a,b){"dssTreeItemFavorite"===b.id.trim()&&($("#dsPageMyComputer").attr("visible","false").hide(),$("#dsPageMyFavorite").attr("visible","true").fadeIn(100)),"dssTreeItemDesktop"===b.id.trim()&&($("#dsPageMyFavorite").attr("visible","false").hide(),$("#dsPageMyComputer").attr("visible","true").fadeIn(100))}),b.getCurrentTopIndex=function(){for(var a=$(".dss-winBox"),b=parseInt(a.eq(0).css("z-index")),c=1;c<a.length;c++)a.eq(c).css("z-index")>parseInt(b)&&(b=a.eq(c).css("z-index"));var d=parseInt(b)+1;return d},b.setWindowTop=function(a){var c=b.getCurrentTopIndex(),d=a;d.css("z-index",c).removeClass("dss-noCurWin").siblings(".dss-winBox").addClass("dss-noCurWin");var e=$("#dss-thumb-icon>li");e.removeClass("hover"),$("#dss-wrap-bottom-bar li[targetId='"+d.attr("id")+"']").addClass("hover")},b.setIcon=function(a,b){$(a).find("ul").find("i").each(function(a,c){var d=$(c).attr("class").split("-");d[1]="icon"+b,$(c).attr("class",d.join("-"))})},b.changeListView=function(a,b){console.log("WindowCtrl changeListView run");var c=b.id.split("-")[1],d=$(b.objEvent.currentTarget).parents(".dss-rt-menu-content"),e=d.attr("id"),f=$("div[ds-bind-popmenu='"+e+"']").find("div[visible='true']").find(".dss-list-view")[0];$(b.objEvent.currentTarget).children("i").addClass("dss-ico-choose-li").end().siblings().children("i").removeClass("dss-ico-choose-li");var g=$(f).attr("c"),h="";switch(c.toUpperCase()){case"SUPER":h="dss-list-supBig-icon "+g,$(f).find("ul").removeClass().addClass(h).show().end().find(".dss-list-detail").hide(),this.setIcon(f,252);break;case"BIG":h="dss-list-big-icon "+g,$(f).find("ul").removeClass().addClass(h).show().end().find(".dss-list-detail").hide(),this.setIcon(f,96);break;case"MID":h="dss-list-mid-icon "+g,$(f).find("ul").removeClass().addClass(h).show().end().find(".dss-list-detail").hide(),this.setIcon(f,48);break;case"SMALL":h="dss-list-small-icon "+g,$(f).find("ul").removeClass().addClass(h).show().end().find(".dss-list-detail").hide(),this.setIcon(f,16);break;case"NORMAL":h="dss-list-li-icon "+g,$(f).find("ul").removeClass().addClass(h).show().end().find(".dss-list-detail").hide(),this.setIcon(f,16);break;case"DETAIL":$(f).find("ul").hide().end().find(".dss-list-detail").show();break;case"TILE":h="dss-list-tile-icon "+g,$(f).find("ul").removeClass().addClass(h).show().end().find(".dss-list-detail").hide(),this.setIcon(f,48);break;case"CONTENT":h="dss-list-content-icon "+g,$(f).find("ul").removeClass().addClass(h).show().end().find(".dss-list-detail").hide(),this.setIcon(f,32)}}}]).controller("WindowCtrlTwo",["$scope",function(a){a.$on("window-settop",function(b,c){a.setWindowTop(c)}),a.getCurrentTopIndex=function(){for(var a=$(".dss-winBox"),b=parseInt(a.eq(0).css("z-index")),c=1;c<a.length;c++)a.eq(c).css("z-index")>parseInt(b)&&(b=a.eq(c).css("z-index"));var d=parseInt(b)+1;return d},a.setWindowTop=function(b){var c=a.getCurrentTopIndex(),d=b;d.css("z-index",c).removeClass("dss-noCurWin").siblings(".dss-winBox").addClass("dss-noCurWin");var e=$("#dss-thumb-icon>li");e.removeClass("hover"),$("#dss-wrap-bottom-bar li[targetId='"+d.attr("id")+"']").addClass("hover")},a.$on("buttonClick",function(b,c){"dss-progress-close"===c.id&&($("#dsswin-format").fadeOut(),$("#dsswin-format").find(".dss-progress").children("span").css("width","0%")),"dss-progress-start"===c.id&&$("#dssDialog-confirm-01").fadeIn(function(){a.setWindowTop($("#dssDialog-confirm-01"))}),"dssDialog-confirm-btnOk01"===c.id&&($("#dssDialog-confirm-01").fadeOut(),$("#dsswin-format").find(".dss-progress").children("span").css("width","0%"),$("#dsswin-format").find(".dss-progress").children("span").animate({width:"100%"},4e3,function(){a.setWindowTop($("#dssDialog-box-01")),$("#dssDialog-box-01").fadeIn(),$("#dss-disk-d").find(".dss-disk-space span").css("width","0%"),$("#dss-disk-d").find(".dss-file-size").text("120 GB free of 120 GB")})),"dssDialog-box-btnOk02"===c.id&&$("#dssDialog-box-01").fadeOut(),"dssDialog-box-btnOk03"===c.id&&$("#dssDialog-box-02").fadeOut()})}]);
/*! dst-web update time： 2014-04-18 */